# 04.04. Протокол OSPF. Настройка и диагностика - Лебедев Д.С.
### Задание 1.
> Все сети указанные на картинке анонсированы. Изначальную конфигурацию вы сможете найти по [ссылке](_attachments/0404-00-00_homework_4_4_routers_config.md).
> ![](_attachments/0404-01-00.png)  
> Необходимо:
> - настроить фильтрацию маршрутов из Area 7. В Area 0 из Area 7 должны попадать только маршруты с подсетью /24, в другие зоны передаются все маршруты. На каких маршрутизаторах и какие команды надо применить для выполнения данного правила?
> - настроить фильтрацию маршрутов из Area 3 так, чтоб маршруты: 192.168.8.0/25 и 192.168.88.0/25 не попадали в Area 5.
> - настроить так, чтобы в таблице маршрутизации:
>   - на R9 были только чётные маршруты: 10.10.0.0/24, 10.10.2.0/24 из Area 0,
>   - на R10 нечетные: 10.10.1.0/24, 10.10.3.0/24.
> *Для каждого подзадания приведите список маршрутизаторов, на которых необходимы изменения со списком полных команд на нём.*

*Ответ:*  















```sh
Необходимо настроить фильтры маршрутов (route filters) в OSPF (Open Shortest Path First) для различных областей (areas). Давайте рассмотрим каждый пункт вашего задания отдельно.

1. Фильтрация маршрутов из Area 7 в Area 0:

Для этого потребуется настроить ABR (Area Border Router), которые соединяют Area 7 с Area 0. Исходя из представленной схемы сети, таковым является маршрутизатор R3. Команды сначала включат доступ к списку (prefix-list) и укажут условие фильтрации, после чего этот список применят в настройке OSPF:

Команды для R3:


router ospf 1
 area 7 filter-list prefix ONLY-/24 out

ip prefix-list ONLY-/24 seq 5 permit 0.0.0.0/0 ge 24 le 24


2. Фильтрация маршрутов из Area 3 в Area 5:
Здесь потребуется настройка сразу на двух ABR - R2 и R3:  

На R2:

router ospf 1
 area 5 filter-list prefix BLOCK-SUBNETS in

ip prefix-list BLOCK-SUBNETS seq 5 deny 192.168.8.0/25
ip prefix-list BLOCK-SUBNETS seq 10 deny 192.168.88.0/25
ip prefix-list BLOCK-SUBNETS seq 15 permit 0.0.0.0/0 le 32

R3:

router ospf 1
 area 5 filter-list prefix BLOCK-SUBNETS in

ip prefix-list BLOCK-SUBNETS seq 5 deny 192.168.8.0/25
ip prefix-list BLOCK-SUBNETS seq 10 deny 192.168.88.0/25
ip prefix-list BLOCK-SUBNETS seq 15 permit 0.0.0.0/0 le 32

3. Фильтрация чётных и нечётных маршрутов для R9 и R10:
R9 и R10 находятся в Area 5, поэтому нужно будет настроить Route Map и применить фильтрацию на каждом маршрутизаторе соответственно.

На R9:

router ospf 1
 distribute-list route-map EVEN-SUBNETS in

access-list 10 permit 10.10.0.0 0.0.0.255
access-list 10 permit 10.10.2.0 0.0.0.255
access-list 20 deny   any

route-map EVEN-SUBNETS permit 10
 match ip address 10
!
route-map EVEN-SUBNETS deny 20


На R10:

router ospf 1
 distribute-list route-map ODD-SUBNETS in

access-list 10 permit 10.10.1.0 0.0.0.255
access-list 10 permit 10.10.3.0 0.0.0.255
access-list 20 deny   any

route-map ODD-SUBNETS permit 10
 match ip address 10
!
route-map ODD-SUBNETS deny 20
```














### Задание 2.
> По топологии из Задания 1, настройте следующую суммаризацию:
> 1. Маршруты из Area 3 во всех других зонах должны быть представлены как суммированный маршрут 192.168.0.0 255.255.0.0. На каких маршрутизаторах и какие команды надо применить для выполнения данного правила?
> 2*. На маршрутизаторах R7 и R8 настроить анонс маршрута по умолчанию. Сделать так, чтобы маршрутизатор R1 предпочитал маршрут по умолчанию из Area 7, из Area 3 должен быть резервным. На каких маршрутизаторах и какие команды надо применить для выполнения данного правила?
> *Для каждого подзадания приведите список маршрутизаторов, на которых необходимы изменения со списком полных команд на нём.*

*Ответ:*  










```
На основе предоставленной топологии сети, команды должны быть выполнены на маршрутизаторах, граничащих с Area 3, чтобы суммировать маршруты. Эти маршрутизаторы находятся на границах с другими OSPF areas, которые нужно охватить суммаризацией.



На R2:

router ospf 1
 area 3 range 192.168.0.0 255.255.0.0


Это будет анонсировать суммированный маршрут в другие зоны. Обратите внимание, что номер процесса OSPF может отличаться и его следует заменить соответствующим значением (в данном примере используется 1).

**Настройка анонса маршрута по умолчанию:**
Для объявления маршрута по умолчанию маршрутизаторами R7 и R8 и настройки приоритета восприятия маршрута по умолчанию для R1, вам понадобится выполнить следующие команды:

На R7:

router ospf 1
 default-information originate


На R8:

router ospf 1
 default-information originate


Эти команды заставят R7 и R8 анонсировать маршрут по умолчанию в OSPF.

Чтобы R1 предпочитал маршрут по умолчанию из Area 7 и сделал Area 3 резервным, его конфигурацию можно настроить с помощью метрик для маршрутов по умолчанию:

На R1:

router ospf 1
 distance ospf external 90 150


Такая конфигурация устанавливает значение "administrative distance" для внешних маршрутов (E1 и E2). Значения метрик необходимо установить, исходя из конкретной топологии и требований. В данном примере, для маршрутов из Area 7 устанавливается меньшее значение (90), что делает их более предпочтительными. Для маршрутов из Area 3 устанавливается большее значение (150), что делает их резервными.
```

### Задание 3.
> По картинке и конфигурации, определить установят ли соседство маршрутизаторы R1 и R2? Почему? Как без использования команд просмотра конфигурации `show running-config`, используя команды диагностики OSPF `show ip ospf *`, можно установить и решить проблему установления соседства?
> ![](_attachments/0404-03-00.png)  
> *Приведите ответы на вопросы в свободной форме. Пришлите список маршрутизаторов и команд, сделанных на этих маршрутизаторах.*

*Ответ:*  








```
Исходя из предоставленной картинки конфигурации двух маршрутизаторов R1 и R2, можно заметить несоответствие в настройке OSPF, которое не позволит установить соседство между ними.

На R1 интерфейс Fa0/0 привязан к области OSPF с номером 1, тогда как на R2 тот же интерфейс (Fa0/0) привязан к области OSPF с номером 2. Для установления соседства в протоколе OSPF, интерфейсы обоих маршрутизаторов должны находиться в одной и той же области (area).

Чтобы диагностировать и устранить проблему, не используя команду `show running-config`, следует воспользоваться командами диагностики OSPF:

1. `show ip ospf neighbor` — покажет состояние соседства OSPF. Если соседство не устанавливается, маршрутизаторы не будут отображаться в списке соседей.

2. `show ip ospf interface` — покажет подробную информацию о каждом интерфейсе, включая привязанную область OSPF (`Area ID`), что позволит выявить несоответствия областей на соседних интерфейсах.

3. `show ip ospf` — показывает общую информацию о настройке OSPF, включая все настроенные области.

Чтобы решить проблему после подтверждения различия в настройке областей, необходимо либо изменить настройку области на одном из маршрутизаторов, чтобы они совпадали, либо настроить соответствие network statements таким образом, чтобы интерфейсы, формирующие соседство, принадлежали к одной и той же области.

Например, если решено привести интерфейс Fa0/0 на R2 к области 1, то команды на R2 будут выглядеть следующим образом:


router ospf 1
 no network 192.168.20.0 0.0.0.255 area 2
 network 192.168.20.0 0.0.0.255 area 1


После этого изменения маршрутизаторы R1 и R2 должны установить соседство, поскольку интерфейсы Fa0/0 обоих маршрутизаторов будут находиться в одной и той же области OSPF (area 1).
```